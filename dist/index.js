(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Pathfinding:()=>i});const s=require("worker_threads");class r{listeners=new Map;parent;constructor(e){this.parent=e,this.parent.on("message",(e=>{this.listeners.get(e.event)?.(e.payload)}))}on(e,t){this.listeners.set(e,t)}send(e,t){this.parent.postMessage({event:e,payload:t})}}var a;!function(e){e.CreateTask="CreateTask",e.CompleteTask="CompleteTask",e.CancelTask="CancelTask",e.AddLayer="AddLayer",e.RemoveLayer="RemoveLayer",e.SetWalkable="SetWalkable",e.SetWeight="SetWeight"}(a||(a={}));class i{worker;weights=[];layers={};lastTaskId=0;resultCallbacks=new Map;events;constructor({workerPath:e="./pathfinding.worker.js",rate:t}={}){this.worker=new s.Worker(e,{workerData:{rate:t}}),this.events=new r(this.worker),this.events.on(a.CompleteTask,(({idTask:e,result:t})=>{const s=this.resultCallbacks.get(e);s&&(s(t),this.resultCallbacks.delete(e))}))}destroy(){return this.worker.terminate()}addLayer(e,t){this.layers[e]=t,this.events.send(a.AddLayer,{layer:e,grid:t})}getLayer(e){return this.layers[e]??null}removeLayer(e){if(!this.layers[e])throw Error(`Layer of pathfinding grid '${e}' is not found`);delete this.layers[e],this.events.send(a.RemoveLayer,{layer:e})}setWalkable(e,t,s){if(!this.layers[e])throw Error(`Layer of pathfinding grid '${e}' is not found`);this.isWalkable(e,t)!==s&&(this.layers[e][t.y]||(this.layers[e][t.y]=[]),this.layers[e][t.y][t.x]=s,this.events.send(a.SetWalkable,{position:t,layer:e,state:s}))}isWalkable(e,t){if(!this.layers[e])throw Error(`Layer of pathfinding grid '${e}' is not found`);return Boolean(this.layers[e][t.y]?.[t.x])}setWeight(e,t){this.getWeight(e)!==t&&(this.weights[e.y]||(this.weights[e.y]=[]),this.weights[e.y][e.x]=t,this.events.send(a.SetWeight,{position:e,value:t}))}resetWeight(e){void 0!==this.weights[e.y]?.[e.x]&&(delete this.weights[e.y][e.x],this.events.send(a.SetWeight,{position:e,value:null}))}getWeight(e){return this.weights[e.y]?.[e.x]??1}createTask(e,t){if(!this.layers[e.layer])throw Error(`Layer of pathfinding grid '${e.layer}' is not found`);const s=++this.lastTaskId;return this.events.send(a.CreateTask,{...e,idTask:s}),this.resultCallbacks.set(s,t),s}cancelTask(e){if(!this.resultCallbacks.has(e))throw Error(`Pathfinding task with id '${e}' is not found`);this.events.send(a.CancelTask,{idTask:e}),this.resultCallbacks.delete(e)}}module.exports=t})();