(()=>{"use strict";var e={67:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PATHFINDING_DEFUALT_LAYER=t.PATHFINDING_WORKER_DIST_FILE_NAME=void 0,t.PATHFINDING_WORKER_DIST_FILE_NAME="./dist/index.worker.js",t.PATHFINDING_DEFUALT_LAYER="@default"},716:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PathfindingEvents=void 0,t.PathfindingEvents=class{listeners=new Map;parent;constructor(e){this.parent=e,this.parent.on("message",(e=>{this.listeners.get(e.event)?.(e.payload)}))}on(e,t){this.listeners.set(e,t)}send(e,t){this.parent.postMessage({event:e,payload:t})}}},693:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PathfindingEvent=void 0,function(e){e.CreateTask="CreateTask",e.CompleteTask="CompleteTask",e.CancelTask="CancelTask",e.AddLayer="AddLayer",e.RemoveLayer="RemoveLayer",e.SetWalkable="SetWalkable",e.SetWeight="SetWeight"}(s||(t.PathfindingEvent=s={}))},156:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Pathfinding=void 0;const i=r(s(729)),a=s(167),n=s(67),o=s(716),l=s(693);t.Pathfinding=class{worker;weights=[];layers;lastTaskId=0;resultCallbacks=new Map;events;constructor(e){i.default,this.layers=Array.isArray(e)?{[n.PATHFINDING_DEFUALT_LAYER]:e}:e,this.worker=new a.Worker(n.PATHFINDING_WORKER_DIST_FILE_NAME,{workerData:{layers:this.layers}}),this.events=new o.PathfindingEvents(this.worker),this.events.on(l.PathfindingEvent.CompleteTask,(({idTask:e,result:t})=>{const s=this.resultCallbacks.get(e);s&&(s(t),this.resultCallbacks.delete(e))}))}destroy(){this.worker.terminate()}addLayer(e,t){this.layers[e]=t,this.events.send(l.PathfindingEvent.AddLayer,{layer:e,grid:t})}getLayer(e){return this.layers[e]??null}removeLayer(e){if(!this.layers[e])throw Error(`Layer of pathfinding grid '${e}' is not found`);delete this.layers[e],this.events.send(l.PathfindingEvent.RemoveLayer,{layer:e})}setWalkable(e,t,s=n.PATHFINDING_DEFUALT_LAYER){if(!this.layers[s])throw Error(`Layer of pathfinding grid '${s}' is not found`);this.isWalkable(e,s)!==t&&(this.layers[s][e.y]||(this.layers[s][e.y]=[]),this.layers[s][e.y][e.x]=t,this.events.send(l.PathfindingEvent.SetWalkable,{position:e,layer:s,state:t}))}isWalkable(e,t=n.PATHFINDING_DEFUALT_LAYER){if(!this.layers[t])throw Error(`Layer of pathfinding grid '${t}' is not found`);return Boolean(this.layers[t][e.y]?.[e.x])}setWeight(e,t){this.getWeight(e)!==t&&(this.weights[e.y]||(this.weights[e.y]=[]),this.weights[e.y][e.x]=t,this.events.send(l.PathfindingEvent.SetWeight,{position:e,value:t}))}resetWeight(e){void 0!==this.weights[e.y]?.[e.x]&&(delete this.weights[e.y][e.x],this.events.send(l.PathfindingEvent.SetWeight,{position:e,value:null}))}getWeight(e){return this.weights[e.y]?.[e.x]??1}createTask(e,t){const s=e.layer??n.PATHFINDING_DEFUALT_LAYER;if(!this.layers[s])throw Error(`Layer of pathfinding grid '${s}' is not found`);const r=++this.lastTaskId;return this.events.send(l.PathfindingEvent.CreateTask,{...e,layer:s,idTask:r}),this.resultCallbacks.set(r,t),r}cancelTask(e){if(!this.resultCallbacks.has(e))throw Error(`Pathfinding task with id '${e}' is not found`);this.events.send(l.PathfindingEvent.CancelTask,{idTask:e}),this.resultCallbacks.delete(e)}}},729:(e,t,s)=>{function r(){return new Worker(s.p+"index.worker.js")}s.r(t),s.d(t,{default:()=>r})},167:e=>{e.exports=require("worker_threads")}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,s),a.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var r=s(156);module.exports=r})();