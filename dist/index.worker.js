(()=>{var t={731:(t,e,n)=>{t.exports=n(297)},297:function(t,e){var n,i,s;(function(){var o,r,a,h,u,p,l,c,d,f,g,y,N,_,P;a=Math.floor,f=Math.min,r=function(t,e){return t<e?-1:t>e?1:0},d=function(t,e,n,i,s){var o;if(null==n&&(n=0),null==s&&(s=r),n<0)throw new Error("lo must be non-negative");for(null==i&&(i=t.length);n<i;)s(e,t[o=a((n+i)/2)])<0?i=o:n=o+1;return[].splice.apply(t,[n,n-n].concat(e)),e},p=function(t,e,n){return null==n&&(n=r),t.push(e),_(t,0,t.length-1,n)},u=function(t,e){var n,i;return null==e&&(e=r),n=t.pop(),t.length?(i=t[0],t[0]=n,P(t,0,e)):i=n,i},c=function(t,e,n){var i;return null==n&&(n=r),i=t[0],t[0]=e,P(t,0,n),i},l=function(t,e,n){var i;return null==n&&(n=r),t.length&&n(t[0],e)<0&&(e=(i=[t[0],e])[0],t[0]=i[1],P(t,0,n)),e},h=function(t,e){var n,i,s,o,h,u;for(null==e&&(e=r),h=[],i=0,s=(o=function(){u=[];for(var e=0,n=a(t.length/2);0<=n?e<n:e>n;0<=n?e++:e--)u.push(e);return u}.apply(this).reverse()).length;i<s;i++)n=o[i],h.push(P(t,n,e));return h},N=function(t,e,n){var i;if(null==n&&(n=r),-1!==(i=t.indexOf(e)))return _(t,0,i,n),P(t,i,n)},g=function(t,e,n){var i,s,o,a,u;if(null==n&&(n=r),!(s=t.slice(0,e)).length)return s;for(h(s,n),o=0,a=(u=t.slice(e)).length;o<a;o++)i=u[o],l(s,i,n);return s.sort(n).reverse()},y=function(t,e,n){var i,s,o,a,p,l,c,g,y;if(null==n&&(n=r),10*e<=t.length){if(!(o=t.slice(0,e).sort(n)).length)return o;for(s=o[o.length-1],a=0,l=(c=t.slice(e)).length;a<l;a++)n(i=c[a],s)<0&&(d(o,i,0,null,n),o.pop(),s=o[o.length-1]);return o}for(h(t,n),y=[],p=0,g=f(e,t.length);0<=g?p<g:p>g;0<=g?++p:--p)y.push(u(t,n));return y},_=function(t,e,n,i){var s,o,a;for(null==i&&(i=r),s=t[n];n>e&&i(s,o=t[a=n-1>>1])<0;)t[n]=o,n=a;return t[n]=s},P=function(t,e,n){var i,s,o,a,h;for(null==n&&(n=r),s=t.length,h=e,o=t[e],i=2*e+1;i<s;)(a=i+1)<s&&!(n(t[i],t[a])<0)&&(i=a),t[e]=t[i],i=2*(e=i)+1;return t[e]=o,_(t,h,e,n)},o=function(){function t(t){this.cmp=null!=t?t:r,this.nodes=[]}return t.push=p,t.pop=u,t.replace=c,t.pushpop=l,t.heapify=h,t.updateItem=N,t.nlargest=g,t.nsmallest=y,t.prototype.push=function(t){return p(this.nodes,t,this.cmp)},t.prototype.pop=function(){return u(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return c(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return l(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return h(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return N(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return(e=new t).nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),i=[],void 0===(s="function"==typeof(n=function(){return o})?n.apply(e,i):n)||(t.exports=s)}).call(this)},67:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PATHFINDING_DEFUALT_LAYER=e.PATHFINDING_WORKER_DIST_FILE_NAME=void 0,e.PATHFINDING_WORKER_DIST_FILE_NAME="./dist/index.worker.js",e.PATHFINDING_DEFUALT_LAYER="@default"},716:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathfindingEvents=void 0,e.PathfindingEvents=class{listeners=new Map;parent;constructor(t){this.parent=t,this.parent.on("message",(t=>{this.listeners.get(t.event)?.(t.payload)}))}on(t,e){this.listeners.set(t,e)}send(t,e){this.parent.postMessage({event:t,payload:e})}}},693:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.PathfindingEvent=void 0,function(t){t.CreateTask="CreateTask",t.CompleteTask="CompleteTask",t.CancelTask="CancelTask",t.AddLayer="AddLayer",t.RemoveLayer="RemoveLayer",t.SetWalkable="SetWalkable",t.SetWeight="SetWeight"}(n||(e.PathfindingEvent=n={}))},949:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathfindingNode=void 0,e.PathfindingNode=class{position;distance;parent=null;weight;constructor({position:t,weight:e=1,distance:n}){this.position={...t},this.distance=n,this.weight=e}getBetterGuessDistance(){return this.weight+this.distance}getWeight(){return this.weight}setWeight(t){this.weight=t}getParent(){return this.parent}setParent(t){this.parent=t}compute(){const t=[{...this.position}],e=this.parent?this.parent.getWeight():0;let n=this.getParent();for(;n;)t.push({...n.position}),n=n.getParent();return t.reverse(),{path:t,weight:e}}getNextWeight(t,e){const n=this.position.x+t.x,i=this.position.y+t.y,s=e[i]?.[n]??1;return Math.abs(t.x)+Math.abs(t.y)!==1?s*Math.SQRT2+(e[this.position.y]?.[n]??0)+(e[i]?.[this.position.x]??0):s}}},689:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PATHFINDING_PROCESS_NEXT_DIRECTIINS_DIAGONAL=e.PATHFINDING_PROCESS_NEXT_DIRECTIINS_STRAIGHT=e.PATHFINDING_PROCESS_LOOP_RATE=void 0,e.PATHFINDING_PROCESS_LOOP_RATE=200,e.PATHFINDING_PROCESS_NEXT_DIRECTIINS_STRAIGHT={R:{x:1,y:0},L:{x:-1,y:0},D:{x:0,y:1},U:{x:0,y:-1}},e.PATHFINDING_PROCESS_NEXT_DIRECTIINS_DIAGONAL={RD:{x:1,y:1},RU:{x:1,y:-1},LU:{x:-1,y:-1},LD:{x:-1,y:1}}},566:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathfindingProcess=void 0;const i=n(689);e.PathfindingProcess=class{grids;weights=[];taskQueue=[];timer;constructor(t){this.grids=t,this.timer=setInterval((()=>{try{this.next()}catch(t){console.error(t)}}),i.PATHFINDING_PROCESS_LOOP_RATE)}destroy(){clearTimeout(this.timer)}createTask(t){this.taskQueue.push(t)}cancelTask(t){const e=this.taskQueue.findIndex((e=>e.id===t));-1!==e&&this.taskQueue.splice(e,1)}setWeight(t,e){this.weights[t.y]||(this.weights[t.y]=[]),this.weights[t.y][t.x]=e}resetWeight(t){this.weights[t.y]&&delete this.weights[t.y][t.x]}setWalkable(t,e,n){const i=this.grids[t];i&&(i[e.y][e.x]=n)}next(){const t=this.taskQueue[0];if(!t)return;const e=t.takeLastNode();e?e.position.x===t.to.x&&e.position.y===t.to.y?(this.taskQueue.shift(),t.complete(e.compute())):this.getNextDirections(t,e).forEach((n=>{const i={x:e.position.x+n.x,y:e.position.y+n.y},s=t.getNextWeight(e,n,this.weights),o=t.pickNode(i);o?s<o.getWeight()&&t.useNode(e,o,s):t.addNode(e,i,s)})):(this.taskQueue.shift(),t.complete({path:null,weight:1/0})),this.next()}getNextDirections(t,e){const n={},s=[];return Object.entries(i.PATHFINDING_PROCESS_NEXT_DIRECTIINS_STRAIGHT).forEach((([i,o])=>{this.isWalkable(e,t.layer,o)&&(n[i]=!0,s.push(o))})),Object.entries(i.PATHFINDING_PROCESS_NEXT_DIRECTIINS_DIAGONAL).forEach((([i,o])=>{n[i[0]]&&n[i[1]]&&this.isWalkable(e,t.layer,o)&&s.push(o)})),s}isWalkable(t,e,n){const i=t.position.x+n.x,s=t.position.y+n.y;return Boolean(this.grids[e]?.[s]?.[i])}}},224:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PathfindingTask=void 0;const s=i(n(731)),o=n(67),r=n(949);e.PathfindingTask=class{from;to;id;layer;tree=[];nodes;complete;constructor({idTask:t,from:e,to:n,layer:i},a){this.id=t,this.from={...e},this.to={...n},this.layer=i??o.PATHFINDING_DEFUALT_LAYER,this.complete=a,this.nodes=new s.default(((t,e)=>t.getBetterGuessDistance()-e.getBetterGuessDistance()));const h=new r.PathfindingNode({position:this.from,distance:this.getDistanceFrom(this.from)});this.pushNode(h)}getDistanceFrom(t){return Math.sqrt((t.x-this.to.x)**2+(t.y-this.to.y)**2)}addNode(t,e,n){const i=new r.PathfindingNode({position:e,distance:this.getDistanceFrom(e),weight:n});i.setParent(t),this.pushNode(i)}pushNode(t){this.nodes.push(t),this.tree[t.position.y]||(this.tree[t.position.y]=[]),this.tree[t.position.y][t.position.x]=t}pickNode(t){return this.tree[t.y]?.[t.x]}takeLastNode(){return this.nodes.pop()??null}useNode(t,e,n){e.setWeight(n),e.setParent(t),this.nodes.updateItem(e)}getNextWeight(t,e,n){return t.getWeight()+t.getNextWeight(e,n)}}},167:t=>{"use strict";t.exports=require("worker_threads")}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}(()=>{"use strict";const t=n(167),e=n(716),i=n(693),s=n(566),o=n(224);if(!t.parentPort)throw Error("Undefined parent port of pathfinding worker");const r=new e.PathfindingEvents(t.parentPort),a=new s.PathfindingProcess(t.workerData.grids);r.on(i.PathfindingEvent.CreateTask,(t=>{const e=new o.PathfindingTask(t,(e=>{r.send(i.PathfindingEvent.CompleteTask,{idTask:t.idTask,result:e})}));a.createTask(e)})),r.on(i.PathfindingEvent.CancelTask,(t=>{a.cancelTask(t.idTask)})),r.on(i.PathfindingEvent.SetWeight,(t=>{null===t.value?a.resetWeight(t.position):a.setWeight(t.position,t.value)})),r.on(i.PathfindingEvent.SetWalkable,(t=>{a.setWalkable(t.layer,t.position,t.state)}))})()})();